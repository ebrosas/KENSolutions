@page "/Recruitment/recruitmentrequest"
<link href="~/css/recruitment.css" rel="stylesheet" />

<MudText Typo="Typo.subtitle1" Align="Align.Center" Class="pb-1 ps-2 fw-bolder" Style="color: #004165;">Recruitment Request</MudText>
<MudContainer MaxWidth="MaxWidth.False" Class="px-4">
    <EditForm EditContext="@_editContext"
        OnValidSubmit="HandleValidSubmit" 
        OnInvalidSubmit="HandleInvalidSubmit">
        <DataAnnotationsValidator />
        @if (_hasValidationError && _validationMessages.Any())
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Dense="true" Class="mb-2">
                <MudText Typo="Typo.subtitle1"><strong>Please correct the following data entry errors:</strong></MudText>
                <ul style="margin:0; padding-left:20px;">
                    @foreach (var msg in _validationMessages)
                    {
                        <li>
                            <MudText Typo="Typo.subtitle2" Class="text-white">@msg</MudText>
                            </li>
                    }
                </ul>
            </MudAlert>
        }
        @if (_showErrorAlert)
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" ContentAlignment="HorizontalAlignment.Left"
                      ShowCloseIcon="true" CloseIconClicked="(() => ShowHideError(false))">
                @_errorMessage
            </MudAlert>
        }
        <div id="mainPanel" class="ma-0 full-height mt-0 pt-0" style="overflow-y: scroll; scrollbar-width: none;">
            <MudBreadcrumbs Style="font-size: 12px;" Items="@_breadcrumbItems" SeparatorIcon="@Icons.Material.Filled.ChevronRight" MaxItems="4" Class="mud-primary-text" />
            <MudText Typo="Typo.subtitle1" Align="Align.Start" Class="mt-3 ps-3" Style="color: #004165;">Add / Edit Position Description for <strong>@_recruitmentRequest.JobTitle</strong></MudText>
            <MudExpansionPanels Elevation="0" MultiExpansion="true">
                <MudExpansionPanel Class="pt-0 mt-0" Dense Gutters Expanded>
                    <TitleContent>
                        <div class="d-flex">
                            <MudIcon Icon="fas fa-briefcase" Style="color: #004165;" class="mr-3" Size=Size.Small></MudIcon>
                            <MudText Typo="Typo.subtitle1" Style="text-decoration: underline; color: #004165;"><strong>Position Properties</strong></MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudGrid Spacing="0">
                            <MudItem xs="4" sm="4" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.EmploymentType"
                                                     SearchFunc="SearchEmploymentType!"
                                                     Variant="Variant.Text"
                                                     Label="Employment Type"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for employment type"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_employmentTypeList != null ? _employmentTypeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="4" sm="4" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.QualificationMode"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Qualification Mode"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for qualification mode"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="4" sm="4" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.PositionType"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Position Type"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for qualification mode"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                        <MudGrid Spacing="0">
                            <MudItem xs="4" sm="4" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.InterviewProcess"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Interview Process"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for qualification mode"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="2" sm="2" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudPaper Elevation="0">
                                        <MudText Typo="Typo.caption" Align="Align.Start" Style="color: #004165;">Pre-Assessment</MudText>
                                        <MudPaper Elevation="0" Class="p-0 w-100 d-flex justify-content-start">
                                            <MudSwitch @bind-Value="_recruitmentRequest.IsPreAssessment"  Color="Color.Success" UncheckedColor="Color.Default" LabelPlacement="Placement.Start">Yes/No</MudSwitch>
                                        </MudPaper>                                        
                                    </MudPaper>
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                    </ChildContent>
                </MudExpansionPanel>         
                <MudExpansionPanel Class="pt-0 mt-0" Dense Gutters Expanded>
                    <TitleContent>
                        <div class="d-flex">
                            <MudIcon Icon="fas fa-search" Style="color: #004165;" class="mr-3" Size=Size.Small></MudIcon>
                            <MudText Typo="Typo.subtitle1" Style="text-decoration: underline; color: #004165;"><strong>Choose Attributes for Planning</strong></MudText>                            
                        </div>
                        <div class="mt-1 ps-5">
                            <MudText Typo="Typo.caption" Style="color: #004165;">Note: Those attributes on which template configuration is done will be mandatory for creating the job description or requisition.</MudText>
                        </div>                        
                    </TitleContent>
                    <ChildContent>
                        <MudGrid Spacing="0">
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudTextField @bind-Value="_recruitmentRequest.Company"
                                            For="@(() => _recruitmentRequest.Company)" Label="Company"
                                            Counter="150" MaxLength="150"
                                            HelperText="Max. text input is 50 chars." Variant="Variant.Text" HelperTextOnFocus="true"
                                            Clearable="@_isClearable" Disabled="@_isDisabled" Immediate="true"
                                            Margin="Margin.Dense" Typo="Typo.subtitle2" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.DepartmentName"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Department"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for department"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.Country"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Country"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for country"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.Education"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Education"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for education"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                        <MudGrid Spacing="0">
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.EmployeeClass"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Employee Class"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for department"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.Ethnicity"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Ethnicity"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for department"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.JobTitle"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Job Title"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for country"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                            <MudItem xs="3" Class="px-4">
                                <MudPaper Elevation="0" Class="p-0 w-100">
                                    <MudAutocomplete @bind-Value="_recruitmentRequest.PayGradeDesc"
                                                     SearchFunc="SearchQualficationMode!"
                                                     Variant="Variant.Text"
                                                     Label="Pay Grade"
                                                     Margin="Margin.Normal"
                                                     Dense="true"
                                                     Placeholder="Please Select"
                                                     HelperText="Type a key to search for education"
                                                     HelperTextOnFocus="true"
                                                     Clearable="true" Typo="Typo.subtitle2"
                                                     MaxItems="@(_qualificationModeList != null ? _qualificationModeList.Count : 10)"
                                                     Modal="true" />
                                </MudPaper>
                            </MudItem>
                        </MudGrid>
                    </ChildContent>
                </MudExpansionPanel>
                <MudExpansionPanel Class="pt-0 mt-0" Dense Gutters Expanded>
                    <TitleContent>
                        <div class="d-flex">
                            <MudIcon Icon="fas fa-file-alt" Style="color: #004165;" class="mr-3" Size=Size.Small></MudIcon>
                            <MudText Typo="Typo.subtitle1" Style="text-decoration: underline; color: #004165;"><strong>Position Description</strong></MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudStack Row="true" StretchItems="StretchItems.All" AlignItems="AlignItems.Stretch" Spacing="2" Wrap="Wrap.NoWrap" Class="mb-3">
                            <MudPaper Elevation="0" Class="p-0 w-100">
                                <MudGrid Spacing="0">
                                    <MudItem xs="12" Class="px-0">
                                        <MudPaper Elevation="0" Class="p-0 w-100">
                                            <MudTextField @bind-Value="_recruitmentRequest.JobTitle"
                                                          For="@(() => _recruitmentRequest.JobTitle)" Label="Job Title"
                                                          HelperText="This is field is read-only" Variant="Variant.Filled" HelperTextOnFocus="true"
                                                          Clearable="false" ReadOnly="true" Immediate="true"
                                                          Margin="Margin.Dense" Typo="Typo.subtitle2" />
                                        </MudPaper>
                                    </MudItem>
                                </MudGrid>
                                 <MudGrid Spacing="0">
                                    <MudItem xs="12" Class="px-0">
                                        <div class="qualification-grid">
                                            <MudDataGrid T="JobQualificationDTO" Items="@_recruitmentRequest.QualificationList" Hover="true" Striped="true"
                                                Filterable="_enableFilter" FilterMode="@DataGridFilterMode.ColumnFilterMenu" FilterCaseSensitivity="@DataGridFilterCaseSensitivity.CaseInsensitive"
                                                Hideable="true" PageSize="5"
                                                EditTrigger="DataGridEditTrigger.Manual" ReadOnly="false" EditMode="DataGridEditMode.Form"
                                                TableClass="fixed-table" Bordered="false" Dense="true" ColumnResizeMode="ResizeMode.Column" HorizontalScrollbar="true">
                                                <ToolBarContent>
                                                    <MudPaper Class="d-flex justify-content-start m-0 p-0" Elevation="0">
                                                        <MudTextField @bind-Value="_searchStringQualification" Placeholder="Enter search string" Adornment="Adornment.Start"
                                                                      Immediate="true" Style="width:400px;" Typo="Typo.subtitle1"
                                                                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Small" Class="mt-0">
                                                        </MudTextField>
                                                    </MudPaper>
                                                    <MudSpacer />
                                                    <MudPaper Class="d-flex justify-content-end m-0 p-0" Elevation="0">
                                                        <MudSwitch @bind-Value="_enableFilter" Color="Color.Success" UncheckedColor="Color.Default"
                                                                   Label="Enable Custom Filter" LabelPlacement="Placement.Start" />
                                                        <MudPaper Class="ms-3" Elevation="0">
                                                            <MudFab Color="Color.Info" StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" title="Add new recruitment budget" OnClick="AddQualificationAsync" />
                                                        </MudPaper>
                                                    </MudPaper>
                                                </ToolBarContent>
                                                <Columns>
                                                    <PropertyColumn Property="x => x.AutoId" Hidden Editable="false">
                                                         <EditTemplate Context="row">
                                                             @* Empty to prevent rendering *@
                                                         </EditTemplate>
                                                     </PropertyColumn>
                                                     <PropertyColumn Property="x => x.Qualification" Title="Qualification" Class="col-qualification" />
                                                     <PropertyColumn Property="x => x.Stream" Title="Stream" Class="col-stream" />
                                                     <PropertyColumn Property="x => x.Specialization" Title="Specialization" Class="col-specialization" />
                                                     <TemplateColumn Hidden="false" CellClass="d-flex justify-end">
                                                         <CellTemplate Context="row">
                                                             <MudIconButton Color="Color.Info" title="Edit budget details"
                                                                            Icon="@Icons.Material.Rounded.Edit"
                                                                            OnClick="@(() => EditQualificationAsync(row.Item))">
                                                             </MudIconButton>
                                                             <MudIconButton Color="Color.Error" title="Delete budget record"
                                                                            Icon="@Icons.Material.Rounded.DeleteForever"
                                                                            OnClick="() => DeleteQualification(row.Item)">
                                                             </MudIconButton>
                                                         </CellTemplate>
                                                     </TemplateColumn>
                                                 </Columns>
                                                 <NoRecordsContent>
                                                     <div class="no-data-box">
                                                         <MudIcon Icon="@Icons.Material.Filled.Info" Class="no-data-icon" />
                                                         <span>No data found</span>
                                                     </div>
                                                 </NoRecordsContent>
                                                 <PagerContent>
                                                     <MudDataGridPager T="JobQualificationDTO" PageSizeOptions="new int[] {5,10,20,50,100,500}" />
                                                 </PagerContent>
                                             </MudDataGrid>
                                         </div>
                                    </MudItem>
                                </MudGrid>
                            </MudPaper>
                            <MudPaper Elevation="0" Class="p-0 w-100">
                                <MudGrid Spacing="0">
                                    <MudItem xs="12" Class="px-0">
                                         <MudPaper Elevation="0" Class="p-0 w-100">
                                             <MudTextField @bind-Value="_recruitmentRequest.PositionDescription" Label="Position Description"
                                                           For="@(() => _recruitmentRequest.PositionDescription)"
                                                           HelperText="Type the full job description here"
                                                           Variant="Variant.Outlined" HelperTextOnFocus="true" Counter="1000" MaxLength="1000" Lines="5"
                                                           Clearable="@_isClearable" Disabled="@_isDisabled" Immediate="true" Margin="Margin.Dense" Typo="Typo.subtitle2" />
                                         </MudPaper>
                                     </MudItem>
                                 </MudGrid>
                                <MudGrid Spacing="0">
                                    <MudItem xs="6" Class="px-4">
                                         <MudPaper Elevation="0" Class="p-0 w-100">
                                             <MudSlider @bind-Value="_recruitmentRequest.TotalWorkExperience" Min="0" Max="50"
                                                TickMarks="true" Step="10" TickMarkLabels="@workExperienceLabels"
                                                Color="Color.Info" Size="Size.Medium">
                                                 Total Work Experience: @_recruitmentRequest.TotalWorkExperience.ToString()
                                                </MudSlider>
                                         </MudPaper>
                                     </MudItem>
                                        <MudItem xs="6" Class="px-4">
                                            <MudPaper Elevation="0" Class="p-0 w-100">
                                                <MudSlider @bind-Value="_recruitmentRequest.TotalRelevantExperience" Min="0" Max="25" Color="Color.Info" Size="Size.Medium" ValueLabel="true">
                                                    Relevant Experience: @_recruitmentRequest.TotalRelevantExperience.ToString()
                                                </MudSlider>
                                            </MudPaper>
                                        </MudItem>
                                 </MudGrid>
                            </MudPaper>
                        </MudStack>
                    </ChildContent>
                </MudExpansionPanel>
                <MudScrollToTop TopOffset="100"
                                Selector="#mainPanel"
                                VisibleCssClass="visible absolute"
                                HiddenCssClass="hidden absolute">
                    <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.ArrowUpward" Color="Color.Error">Go to top</MudButton>
                </MudScrollToTop>
            </MudExpansionPanels>
        </div>
    </EditForm>
</MudContainer>

@code {

}
