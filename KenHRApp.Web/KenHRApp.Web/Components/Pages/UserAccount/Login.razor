@page "/login"
@layout KenHRApp.Web.Components.Layout.LoginLayout

<MudContainer MaxWidth="MaxWidth.Small">
    <EditForm EditContext="@_editContext" @ref="_editForm"
        OnValidSubmit="HandleValidSubmit" 
        OnInvalidSubmit="HandleInvalidSubmit">
        <DataAnnotationsValidator />
        @if (_hasValidationError && _validationMessages.Any())
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Dense="true" Class="mb-2">
                <MudText Typo="Typo.subtitle1"><strong>Please correct the following data entry errors:</strong></MudText>
                <ul style="margin:0; padding-left:20px;">
                    @foreach (var msg in _validationMessages)
                    {
                        <li>
                            <MudText Typo="Typo.subtitle2" Class="text-white">@msg</MudText>
                            </li>
                    }
                </ul>
            </MudAlert>
        }

        @if (_showErrorAlert)
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" ContentAlignment="HorizontalAlignment.Left"
                      ShowCloseIcon="true" CloseIconClicked="(() => ShowHideError(false))">
                @_errorMessage
            </MudAlert>
        }
        <MudPaper Elevation="6" Class="pa-6">

            <MudText Typo="Typo.h5" Align="Align.Center" Style="color:#004165;" Class="fw-bold">
                Login
            </MudText>

            <MudTextField @bind-Value="Model.EmployeeCode"
                    Label="User ID / Email"
                    Required="true"
                    Immediate="true"
                    FullWidth="true"
                    HelperText="Enter User ID or Registered Email"
                    HelperTextOnFocus="true"
                    Disabled="@_btnProcessing" />

            <MudTextField @bind-Value="Model.Password"
                            Label="Password"
                            InputType="@PasswordInputType"
                            Adornment="Adornment.End"
                            AdornmentIcon="@PasswordIcon"
                            OnAdornmentClick="TogglePassword"
                            Required="true"
                            FullWidth="true"
                        Disabled="@_btnProcessing" />

            <MudCheckBox T="bool" @bind-Checked="Model.RememberMe" Disabled="@_btnProcessing">
                Remember Me
            </MudCheckBox>

            <MudButton Variant="Variant.Filled"
                ButtonType="ButtonType.Submit"
                Color="Color.Primary"
                Style="background-color:#004165;"
                FullWidth="true"
                Disabled="@_btnProcessing">
                @if (_btnProcessing)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="me-2" />
                    <span>Processing...</span>
                }
                else
                {
                    <span>Login</span>
                }
            </MudButton>

            <MudText Color="Color.Error">@ErrorMessage</MudText>

            <MudStack Row="true" Justify="Justify.SpaceBetween" Class="mt-4">
                <MudLink Disabled="@_btnProcessing" OnClick="ShowUnlockDialog">Unlock Account</MudLink>
                <MudLink Disabled="@_btnProcessing" OnClick="ForgotPassword">Forgot Password?</MudLink>
            </MudStack>

            <MudDivider Class="my-4" />

            <MudLink Disabled="@_btnProcessing" OnClick="GoToSupport">
                Need Support?
            </MudLink>
        </MudPaper>
    </EditForm>    
</MudContainer>
