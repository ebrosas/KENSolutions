@page "/UserAccount/ForgotPassword"

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-12">
    <EditForm EditContext="@_editContext" @ref="_editForm"
              OnValidSubmit="HandleValidSubmit"
              OnInvalidSubmit="HandleInvalidSubmit">
        <DataAnnotationsValidator />
        @if (_hasValidationError && _validationMessages.Any())
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Dense="true" Class="mb-2">
                <MudText Typo="Typo.subtitle1"><strong>Please correct the following data entry errors:</strong></MudText>
                <ul style="margin:0; padding-left:20px;">
                    @foreach (var msg in _validationMessages)
                    {
                        <li>
                            <MudText Typo="Typo.subtitle2" Class="text-white">@msg</MudText>
                            </li>
                    }
                </ul>
            </MudAlert>
        }

        @if (_showErrorAlert)
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" ContentAlignment="HorizontalAlignment.Left"
                      ShowCloseIcon="true" CloseIconClicked="(() => ShowHideError(false))">
                @_errorMessage
            </MudAlert>
        }
        <MudPaper Elevation="6" Class="pa-6">

            <MudText Typo="Typo.h5" Align="Align.Center" Style="color:#004165;" Class="fw-bold">
                Password Recovery
            </MudText>

            <MudStack Justify="Justify.FlexStart" AlignItems="AlignItems.Start" Class="mud-width-full mt-2">
                <MudTextField Label="User ID / Email"
                              @bind-Value="Model.EmployeeCode"
                              For="@(() => Model.EmployeeCode)"
                              HelperText="Enter User ID or Registered Email"
                              MaxLength="50"
                              HelperTextOnFocus="true"
                              Required="true"
                              Immediate="true" 
                              Disabled="@_btnProcessing"
                              Typo="Typo.subtitle1"
                              Margin="Margin.Dense"
                              FullWidth="true" />

                <MudDatePicker Label="Joining Date" Editable="true" @bind-Date="Model.DateOfJoining"
                               For="@(() => Model.DateOfJoining)" AutoClose="true" Color="Color.Info"
                               Margin="Margin.Dense" Required="true" 
                               Disabled="@_btnProcessing"
                               HelperText="Date format: dd/MM/yyyy" HelperTextOnFocus="true" Clearable="false" 
                               Mask="@(new DateMask("dd/MM/yyyy"))" DateFormat="dd/MM/yyyy" Placeholder="dd/MM/yyyy" Variant="Variant.Text">
                    <PickerActions Context="dateContext">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="@(async () => await this.InvokeAsync(() => Model.DateOfJoining = DateTime.Today))">Today</MudButton>
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="@(async () => await this.InvokeAsync(() => Model.DateOfJoining = null))">Clear</MudButton>
                    </PickerActions>
                </MudDatePicker>
            </MudStack>
            
            <MudStack Row Justify="Justify.FlexEnd" AlignItems="AlignItems.Start" Class="mud-width-full">
                 <MudButton Variant="Variant.Filled"
                            ButtonType="ButtonType.Submit"
                            Color="Color.Primary"
                            Style="background-color: #004165"
                            Class="mt-4"
                            FullWidth="false"                            
                            Disabled="@_btnProcessing">
                     @if (_btnProcessing)
                    {
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="me-2" />
                        <span>Processing...</span>
                    }
                    else
                    {
                        <span>Submit</span>
                    }
                </MudButton>
                <MudButton Variant="Variant.Text"
                           Color="Color.Surface"
                           FullWidth="false"
                           Class="mt-4"
                           Disabled="@_btnProcessing"
                           OnClick="GoToLogin">
                    Cancel
                </MudButton>
            </MudStack>
        </MudPaper>
    </EditForm>
</MudContainer>
<!-- Full-screen overlay -->
@* @if (_btnProcessing)
{
    <div class="fullscreen-overlay">
        <MudProgressCircular Indeterminate="true" Size="Size.Medium" Color="Color.Info" />
        <MudText Typo="Typo.h6" Class="mt-2 text-white">@overlayMessage</MudText>
        </div>
}
 *@
