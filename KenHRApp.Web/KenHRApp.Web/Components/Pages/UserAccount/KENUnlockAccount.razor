@page "/UserAccount/Unlock"
@layout KenHRApp.Web.Components.Layout.LoginLayout

<div class="unlock-root unlock-background">

    <!-- Floating Icons (Optional, same as unlock page) -->
    <div class="floating-icons" hidden>
        <MudIcon Icon="@Icons.Material.Filled.Groups" Color="Color.Primary" />
        <MudIcon Icon="@Icons.Material.Filled.Badge" />
        <MudIcon Icon="@Icons.Material.Filled.EventAvailable" />
        <MudIcon Icon="@Icons.Material.Filled.Payments" />
        <MudIcon Icon="@Icons.Material.Filled.Assessment" />
    </div>

    <div class="unlock-container">

        <!-- Left Branding Section -->
        <div class="branding-section fade-in">
            <img src="/images/KENlogo.png"
                 alt="Company Logo"
                 class="company-logo" />

            <MudText Typo="Typo.h4" Class="fw-bold mt-4 text-center text-md-start">
                KEN - HR Management System
            </MudText>

            <MudText Typo="Typo.body2"
                     Class="branding-description mt-2 text-center text-md-start">
                Empowering People. Simplifying Workforce Management.
            </MudText>
        </div>

        <!-- Right Form Section -->
        <div class="unlock-section fade-in">

            <MudContainer MaxWidth="MaxWidth.Small">

                <EditForm EditContext="@_editContext"
                          OnValidSubmit="HandleValidSubmit"
                          OnInvalidSubmit="HandleInvalidSubmit">

                    <DataAnnotationsValidator />

                    <MudPaper Elevation="12" Class="pa-6 pa-md-8 unlock-card">

                        <MudText Typo="Typo.h5" Class="fw-bold mb-4 text-center" Style="color:#004165;">
                            Unlock User Account
                        </MudText>

                        @if (_showErrorAlert && !string.IsNullOrWhiteSpace(_errorMessage.ToString()))
                        {
                            <MudAlert Severity="Severity.Error"
                                      Variant="Variant.Filled"
                                      ShowCloseIcon="true"
                                      CloseIconClicked="(() => ShowHideError(false))"
                                      Class="mb-4">
                                @_errorMessage.ToString()
                            </MudAlert>
                        }

                        @if (_hasValidationError && _validationMessages.Any())
                        {
                            <MudAlert Severity="Severity.Error"
                                      Variant="Variant.Filled"
                                      Dense="true"
                                      Class="mb-4">
                                <MudText Typo="Typo.subtitle1"><strong>Please correct the following data entry errors:</strong></MudText>
                                <ul style="margin:0; padding-left:20px;">
                                    @foreach (var msg in _validationMessages)
                                    {
                                        <li><MudText Typo="Typo.subtitle2" Class="text-white">@msg</MudText></li>
                                    }
                                </ul>
                            </MudAlert>
                        }

                        <MudTextField @bind-Value="Model.EmployeeCode"
                                      Label="User ID / Email"
                                      Variant="Variant.Outlined"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Person"
                                      Required="true"
                                      FullWidth="true"
                                      Class="mb-4"
                                      Disabled="@_btnProcessing" />

                        <MudStack Row Justify="Justify.SpaceBetween">
                             <MudButton Variant="Variant.Filled"
                                        ButtonType="ButtonType.Submit"
                                        Color="Color.Primary"
                                        Style="background-color:#004165;"
                                        Size="Size.Large"
                                        FullWidth="true"
                                        Disabled="@_btnProcessing"
                                        Class="login-btn">
                                 @if (_btnProcessing)
                                {
                                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="me-2" />
                                    <span>Processing...</span>
                                }
                                else
                                {
                                    <span>Unlock</span>
                                }
                            </MudButton>

                            <MudButton Variant="Variant.Text"
                                       Color="Color.Surface"
                                       FullWidth="true"
                                       OnClick="GoToLogin"
                                       Disabled="@_btnProcessing">
                                Cancel
                            </MudButton>
                        </MudStack>

                        <MudDivider Class="my-4" />

                        <MudStack AlignItems="AlignItems.Center" Spacing="1">
                            <MudLink OnClick="ShowSupport">
                                Need Support?
                            </MudLink>
                        </MudStack>

                    </MudPaper>

                </EditForm>

            </MudContainer>

        </div>

    </div>
</div>