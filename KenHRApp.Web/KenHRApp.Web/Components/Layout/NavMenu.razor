@implements IDisposable
@inject NavigationManager NavigationManager
@inject IAppState State
@inject ISharedAction Actions

@* <div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">KenHRApp.Web</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="counter">
                <span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"></span> Counter
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="weather">
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> Weather
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="auth">
                <span class="bi bi-lock-nav-menu" aria-hidden="true"></span> Auth Required
            </NavLink>
        </div>

        <AuthorizeView>
            <Authorized>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="Account/Manage">
                        <span class="bi bi-person-fill-nav-menu" aria-hidden="true"></span> @context.User.Identity?.Name
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <form action="Account/Logout" method="post">
                        <AntiforgeryToken />
                        <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                        <button type="submit" class="nav-link">
                            <span class="bi bi-arrow-bar-left-nav-menu" aria-hidden="true"></span> Logout
                        </button>
                    </form>
                </div>
            </Authorized>
            <NotAuthorized>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="Account/Register">
                        <span class="bi bi-person-nav-menu" aria-hidden="true"></span> Register
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="Account/Login">
                        <span class="bi bi-person-badge-nav-menu" aria-hidden="true"></span> Login
                    </NavLink>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </nav>
</div> *@


<MudNavMenu Color="Color.Primary" Margin="Margin.Dense" Dense="true" Style="font-size: 14px;">
    @* <MudNavLink Href="/" Match="NavLinkMatch.All" Class="ms-0 ps-0">
        <MudIcon Icon="fas fa-chart-pie" Class="navMenu navlink-icon-sm ps-0 me-1" Title="Homepage" />
        Dashboard
    </MudNavLink> *@
    <MudNavGroup Title="Core HR" Icon="fas fa-user-friends" Expanded="true" Class="navMenu navlink-icon-sm">
        <MudNavLink Icon="fas fa-user-cog" Class="navMenu navlink-icon-sm" OnClick="ShowEmployeeMaster">Employee Master</MudNavLink>
        <MudNavLink Icon="fas fa-sitemap" Class="navMenu navlink-icon-sm" OnClick="ShowDepartmentMaster">Department Master</MudNavLink>
        <MudNavLink Href="/CompensationSetup" Icon="fas fa-donate" Class="navMenu navlink-icon-sm">Compensation Setup</MudNavLink>
        <MudNavLink Href="/Announcements" Icon="fas fa-bullhorn" Class="navMenu navlink-icon-sm">Announcements</MudNavLink>
        <MudNavLink Href="/Surveys" Icon="fas fa-chart-line" Class="navMenu navlink-icon-sm">Surveys</MudNavLink>
        <MudNavLink Href="/Rewards" Icon="fas fa-award" Class="navMenu navlink-icon-sm">Rewards</MudNavLink>
        <MudNavLink Href="/SocialFeed" Icon="fas fa-retweet" Class="navMenu navlink-icon-sm">Social Feed</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Time & Attendance" Icon="fas fa-calendar-check" Class="navlink-icon-sm navMenu">
        <MudNavLink Icon="fas fa-chart-bar" Class="navMenu navlink-icon-sm" OnClick="OpenEmployeeDashboard">Attendance Dashboard</MudNavLink>
        <MudNavLink Href="/SelfService" Icon="fas fa-user-edit" Class="navMenu navlink-icon-sm">Self Service</MudNavLink>
        <MudNavLink Icon="fas fa-people-carry" Class="navMenu navlink-icon-sm" OnClick="ShowShiftRoster">Shift Roster</MudNavLink>
        <MudNavLink Href="/ExtraTime" Icon="far fa-calendar-plus" Class="navMenu navlink-icon-sm">Extratime Request</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-tasks" Class="navMenu navlink-icon-sm" hidden>Manual Attendance</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-eraser" Class="navMenu navlink-icon-sm" hidden>Reason of Absence</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-edit" Class="navMenu navlink-icon-sm" hidden>Timesheet Correction</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-history" Class="navMenu navlink-icon-sm" hidden>Attendance Calendar</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-theater-masks" Class="navMenu navlink-icon-sm" hidden>Face Attendance</MudNavLink>
        <MudNavLink Href="/security" Icon="far fa-clock" Class="navMenu navlink-icon-sm" hidden>Punch In/Out</MudNavLink>
        <MudNavLink Href="/security" Icon="fas fa-person-booth" Class="navMenu navlink-icon-sm" hidden>Time Office</MudNavLink>
        <MudNavLink Href="/TimeCard" Icon="fas fa-user-clock" Class="navMenu navlink-icon-sm">Time Card</MudNavLink>
        <MudNavLink Href="/DigitalID" Icon="fas fa-address-card" Class="navMenu navlink-icon-sm">Digital ID</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Employee Life Cycle" Icon="fas fa-cogs" Class="navMenu navlink-icon-sm">
        <MudNavLink Href="/EmployeeProfile" Icon="fas fa-user-lock" Class="navMenu navlink-icon-sm">Employee Profile</MudNavLink>
        <MudNavLink Href="/ManageMapping" Icon="fas fa-wrench" Class="navMenu navlink-icon-sm">Manage Mapping</MudNavLink>
        <MudNavLink Href="/EPA" Icon="fas fa-file-import" Class="navMenu navlink-icon-sm">Performance Appraisal</MudNavLink>
        <MudNavLink Href="/PAF" Icon="@Icons.Material.TwoTone.AreaChart" Class="navMenu navlink-icon-sm">PAF</MudNavLink>
        <MudNavLink Href="/EmployeeTransfer" Icon="fas fa-dolly" Class="navMenu navlink-icon-sm">Employee Transfer</MudNavLink>
        <MudNavLink Href="/EmployeeSeparation" Icon="@Icons.Material.TwoTone.AreaChart" Class="navMenu navlink-icon-sm">Employee Separation</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Leave Management" Icon="fas fa-user-cog" Class="navMenu navlink-icon-sm">
        <MudNavLink Href="/security" Icon="@Icons.Material.TwoTone.Security" Class="navMenu navlink-icon-sm">Leave Request</MudNavLink>
        <MudNavLink Href="/users" Icon="far fa-thumbs-up" Class="navMenu navlink-icon-sm">Leave Approval</MudNavLink>
        <MudNavLink Href="/users" Icon="@Icons.Material.TwoTone.People" Class="navMenu navlink-icon-sm">Leave Entitlement</MudNavLink>
        <MudNavLink Href="/users" Icon="@Icons.Material.TwoTone.People" Class="navMenu navlink-icon-sm">Leave Cancellation</MudNavLink>
        <MudNavLink Href="/users" Icon="@Icons.Material.TwoTone.People" Class="navMenu navlink-icon-sm">Leave Planner</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Learning Management" Icon="fas fa-chalkboard-teacher" Class="navMenu navlink-icon-sm">
        <MudNavLink Href="/security" Icon="fas fa-laptop" Class="navMenu navlink-icon-sm">Training Registration</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-print" Class="navMenu navlink-icon-sm">Training Attendance</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Recruitment" Icon="far fa-handshake" Class="navlink-icon-sm">
        <MudNavLink Icon="fas fa-handshake" Class="navMenu navlink-icon-sm" OnClick="ShowRecruitment">Manage Requitment</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-door-open" Class="navMenu navlink-icon-sm">Employee Separation</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-file-signature" Class="navMenu navlink-icon-sm">Contract Renewal</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-chart-line" Class="navMenu navlink-icon-sm">Probationary Assessment</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Travel & Expense" Icon="fas fa-luggage-cart" Class="navMenu navlink-icon-sm">
        <MudNavLink Href="/security" Icon="fas fa-plane-departure" Class="navMenu navlink-icon-sm">Travel Request</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-suitcase-rolling" Class="navMenu navlink-icon-sm">Travel History</MudNavLink>
        <MudNavLink Href="/users" Icon="far fa-handshake" Class="navMenu navlink-icon-sm">Travel Approval</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-tools" Class="navMenu navlink-icon-sm">Travel Configuration</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-cloud-upload-alt" Class="navMenu navlink-icon-sm">Travel Data Mapping</MudNavLink>
    </MudNavGroup>
    <MudNavGroup Title="Payroll" Icon="fas fa-money-check-alt" Class="navMenu navlink-icon-sm">
        <MudNavLink Href="/security" Icon="fas fa-hand-holding-usd" Class="navMenu navlink-icon-sm">Payroll Process</MudNavLink>
        <MudNavLink Href="/users" Icon="far fa-credit-card" Class="navMenu navlink-icon-sm">Payslip Generation</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-archive" Class="navMenu navlink-icon-sm">Global Bulk Payslip</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-keyboard" Class="navMenu navlink-icon-sm">Payslip Configuration</MudNavLink>
        <MudNavLink Href="/users" Icon="fas fa-upload" Class="navMenu navlink-icon-sm">Timesheet Upload</MudNavLink>
    </MudNavGroup>
    
    @* <MudNavLink Href="counter">
        <MudIcon Icon="@Icons.Material.TwoTone.AddBox" Size=Size.Small />
        Counter
    </MudNavLink>
    <MudNavLink Href="weather">
        <MudIcon Icon="@Icons.Material.Filled.List" Size=Size.Small />
        Weather
    </MudNavLink>
    <MudNavLink Href="employees">
        <MudIcon Icon="@Icons.Material.Filled.People" Size=Size.Small />
        Employees
    </MudNavLink>

    <MudDivider Class="my-2" DividerType="DividerType.Middle" />
    <MudNavGroup Title="Settings" Icon="@Icons.Material.Filled.Settings" Expanded="false" Size=Size.Small>
        <MudNavLink Href="/users" Icon="@Icons.Material.Filled.People" IconColor="Color.Success" Size=Size.Small>Users</MudNavLink>
        <MudNavLink Href="/security" Icon="@Icons.Material.Filled.Security" IconColor="Color.Info" Size=Size.Small>Security</MudNavLink>        
    </MudNavGroup>
    <AuthorizeView>
        <Authorized>
            <MudNavLink Href="Account/Manage">
                <MudIcon Icon="@Icons.Material.Filled.Person" Size=Size.Small />
                @context.User.Identity?.Name
            </MudNavLink>
            <MudNavLink Href="Account/Logout" OnClick="() => NavigationManager.NavigateTo("Account/Logout", true)">
                <MudIcon Icon="@Icons.Material.Filled.ExitToApp" />
                Logout
            </MudNavLink>
        </Authorized>
        <NotAuthorized>
            <MudNavLink Href="Account/Register">
                <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Size=Size.Small />
                Register
            </MudNavLink>
            <MudNavLink Href="Account/Login">
                <MudIcon Icon="@Icons.Material.Filled.Login" Size=Size.Small />
                Login
            </MudNavLink>
        </NotAuthorized>
    </AuthorizeView> *@
</MudNavMenu>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    #region Private Methods
    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    private void ShowEmployeeMaster()
    {
        NavigationManager.NavigateTo("/CoreHR/employeesearch");
        Actions.InvokeShowHideDrawer();
    }


    private void ShowDepartmentMaster()
    {
        NavigationManager.NavigateTo("/CoreHR/departmentmaster");
        Actions.InvokeShowHideDrawer();
    }

    private void ShowRecruitment()
    {
        NavigationManager.NavigateTo("/Recruitment/recruitmenthome");
        Actions.InvokeShowHideDrawer();
    }

    private void ShowShiftRoster()
    {
        NavigationManager.NavigateTo("/TimeAttendance/shiftrostersearch");        
        Actions.InvokeShowHideDrawer();
    }

    private void OpenEmployeeDashboard()
    {
        NavigationManager.NavigateTo("/TimeAttendance/tnadashboard");
        // NavigationManager.NavigateTo("/TimeAttendance/shiftrostersearch");
        Actions.InvokeShowHideDrawer();
    }
    #endregion

    #region Public Methods
    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
    #endregion
}

